(async()=>{for(;!Spicetify.React||!Spicetify.ReactDOM;)await new Promise(e=>setTimeout(e,10));var o,a,u,e;a=null,u={background:"",text:"",button:"",buttonHover:""},e=async function(){async function r(e){var t=document.body;return t?getComputedStyle(t).getPropertyValue(e).trim():""}async function t(){var e={background:await r("--background-base"),text:await r("--text-base"),button:await r("--background-press"),buttonHover:await r("--text-bright-accent")};e.background===u.background&&e.text===u.text&&e.button===u.button&&e.buttonHover===u.buttonHover||(console.log("Theme colors changed, updating..."),u=e,null!=(e=document.getElementById("repeat-menu"))&&e.remove())}function l(e){e&&!a?a=setInterval(t,1e3):!e&&a&&(clearInterval(a),a=null)}function e(){var e=document.querySelector(".main-nowPlayingBar-extraControls");if(e){if(!e.querySelector("#custom-repeat-button")){let o=new Spicetify.Playbar.Button("Convenient Repeat","repeat",async()=>{var e,t,n=document.getElementById("repeat-menu");n?(n.remove(),l(!1)):(n=await(async()=>{var e=document.getElementById("repeat-menu");if(!e){l(!0);let n=document.createElement("div"),[e,t,o,a]=(n.id="repeat-menu",await Promise.all([r("--background-base"),r("--text-base"),r("--background-press"),r("--text-bright-accent")]));n.style.position="absolute",n.style.background=e||"#282828",n.style.color=t||"#fff",n.style.padding="10px",n.style.borderRadius="5px",n.style.boxShadow="0px 4px 6px rgba(0, 0, 0, 0.3)",n.style.display="flex",n.style.gap="5px",n.style.fontSize="14px",n.style.cursor="pointer",n.style.zIndex="9999";return[{label:"Repeat Off",value:0},{label:"Repeat All",value:1},{label:"Repeat One",value:2}].forEach(e=>{let t=document.createElement("div");t.innerText=e.label,t.style.padding="5px 10px",t.style.borderRadius="3px",t.style.background=o||"#333",t.style.textAlign="center",t.style.transition="background 0.2s ease-in-out",t.addEventListener("mouseover",()=>t.style.background=a||"#444"),t.addEventListener("mouseout",()=>t.style.background=o||"#333"),t.onclick=()=>{Spicetify.Player.setRepeat(e.value),n.remove(),l(!1)},n.appendChild(t)}),n}e.remove(),l(!1)})())&&(document.body.appendChild(n),e=(t=o.element.getBoundingClientRect()).left+t.width/2,t=t.top,n.style.left=e-n.offsetWidth/2+window.scrollX+"px",n.style.top=t+window.scrollY-n.offsetHeight-10+"px")},!1,!1);o.element.id="custom-repeat-button",o.element.style.cursor="pointer",o.register(),e.insertBefore(o.element,e.firstChild)}}else console.warn("Repeat button container not found!")}e();let n=new MutationObserver(()=>{clearTimeout(o),o=setTimeout(()=>{document.getElementById("custom-repeat-button")||e()},200)});n.observe(document.body,{childList:!0,subtree:!0}),window.addEventListener("unload",()=>{n.disconnect(),a&&clearInterval(a)})},(async()=>{await e()})()})();